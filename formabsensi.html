<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Form Absensni</title>
  <link href="https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@500;700&display=swap" rel="stylesheet" />
  <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;600;700&display=swap" rel="stylesheet" />
  <script src="https://cdn.jsdelivr.net/npm/compressorjs@1.2.1/dist/compressor.min.js"></script>
<style>
  :root {
  /* Light mode variables */
  --bg-light: #ffffff;
  --text-light: #1a1a1a;
  --subtitle-light: #666666;
  --grid-light: rgba(0, 0, 0, 0.05);
  --btn-bg-light: #000000;
  --btn-hover-light: #ff4500;
  --input-bg-light: #ffffff;
  --input-border-light: #999999;
  --input-text-light: #1a1a1a;
  --table-header-bg-light: #f5f5f7;
  --table-row-bg-light: #ffffff;
  --table-row-hover-light: #f0f0f5;
  --table-border-light: rgba(0, 0, 0, 0.12);
  --success-bg-light: #28a745;
  --success-border-light: #1e7e34;
  --error-bg-light: #dc3545;
  --error-border-light: #b02a37;
}

body.dark {
  /* Dark mode variables */
  --bg-dark: #121212;
  --text-dark: #e0e0e0;
  --subtitle-dark: #999999;
  --grid-dark: rgba(255, 255, 255, 0.12);
  --btn-bg-dark: #e0e0e0;
  --btn-hover-dark: #ff6600;
  --input-bg-dark: #1e1e1e;
  --input-border-dark: #555555;
  --input-text-dark: #e0e0e0;
  --table-header-bg-dark: #1f1f1f;
  --table-row-bg-dark: #242424;
  --table-row-hover-dark: #333333;
  --table-border-dark: rgba(255, 255, 255, 0.12);
  --success-bg-dark: #34c759;
  --success-border-dark: #238c3d;
  --error-bg-dark: #ff453a;
  --error-border-dark: #bf3e34;
}

/* Global styles using the variables */
body {
  margin: 0;
  font-family: 'Montserrat', sans-serif;
  background-color: var(--bg-light);
  background-image:
  linear-gradient(to right, var(--grid-light) 1px, transparent 1px),
  linear-gradient(to bottom, var(--grid-light) 1px, transparent 1px);
  background-size: 30px 30px;
  color: var(--text-light);
  transition: background-color 0.5s ease, color 0.5s ease;
  min-height: 100vh;
  display: flex;
  justify-content: center;
  align-items: center;
  position: relative;
}

body.dark {
  background-color: var(--bg-dark);
  background-image:
  linear-gradient(to right, var(--grid-dark) 1px, transparent 1px),
  linear-gradient(to bottom, var(--grid-dark) 1px, transparent 1px);
  color: var(--text-dark);
}
.subtitle {
  text-align: center;
  font-weight: 400;
  margin: 1rem 0;
  font-size: 14px;
  color: var(--subtitle-light);
margin-top : 0px;
margin-bottom : 20px;
}

body.dark .subtitle {
  color: var(--subtitle-dark);
}

/* Container */
.container {
  background-color: var(--bg-light);
  color: var(--text-light);
  padding: 2rem;
  border-radius: 16px;
  box-shadow: 0 4px 20px rgba(0, 0, 0, 0.08);
  max-width: 600px;
  width: 100%;
  text-align: center;
  transition: background-color 0.5s ease, color 0.5s ease;
}

body.dark .container {
  color: var(--text-dark);
  background: #1E1E1E;
  box-shadow: 0 4px 20px rgba(0,0,0,0.6);
}

/* Form layout */
form {
  display: flex;
  flex-wrap: wrap;
  gap: 12px;
  justify-content: center;
}

.form-group {
  flex: 1 1 45%;
  display: flex;
  flex-direction: column;
}

.form-group.full {
  flex: 1 1 100%;
}

label {
  font-weight: 500;
  margin-bottom: 4px;
  text-align: center;
  color: var(--subtitle-light);
  transition: color 0.5s ease;
}

body.dark label {
  color: var(--subtitle-dark);
}

input {
      background: #fff;
      font-family: 'Montserrat';
      border: 2px solid #000;
      border-radius: 20px;
      padding: 0.75rem 1rem;
      font-size: 16px;
      color: #000;
      transition: border-color 0.3s ease, background-color 0.5s ease, color 0.5s ease;
      user-select: text;
      text-align : center;
    }

body.dark input {
      background: #222;
      border-color: #eee;
      color: #eee;
    }
input::placeholder {
    color: #666;
}

body.dark input::placeholder {
      color: #aaa;
    }

input:focus {
  outline: none;
  border-color: var(--btn-hover-light);
  box-shadow: 0 0 6px var(--btn-hover-light);
}

body.dark input:focus {
  border-color: var(--btn-hover-dark);
  box-shadow: 0 0 6px var(--btn-hover-dark);
}

/* Time display */
#waktu {
  font-family: 'JetBrains Mono', monospace;
  font-size: 3.2rem;
  font-weight: 700;
  color: var(--text-light);
  text-shadow: 0 0 8px rgba(0, 0, 0, 0.1);
  margin: 0.5rem 0 0.5rem;
  letter-spacing: 0.1em;
  user-select: none;
  transition: color 0.5s ease;
}

body.dark #waktu {
  color: var(--text-dark);
  text-shadow: 0 0 10px rgba(255, 255, 255, 0.15);
}

/* Preview image */
#preview {
  margin-top: 1rem;
  border-radius: 12px;
  max-width: 100%;
  height: auto;
  display: block;
  margin-left: auto;
  margin-right: auto;
}

/* Upload button */
.ios-upload-button {
  display: inline-flex;
  align-items: center;
  justify-content: center;
  gap: 0.5rem;
  padding: 0.75rem 1.5rem;
  font-size: 1rem;
  font-weight: 600;
  background-color: var(--bg-light);
  color: var(--text-light);
  border-radius: 30px;
  cursor: pointer;
  box-shadow: 0 2px 4px rgba(0, 0, 0, 0.05);
  transition: background-color 0.3s, box-shadow 0.3s, color 0.5s ease, background-color 0.5s ease;
  margin-bottom: 8px;
  width: 100%;
}

body.dark .ios-upload-button {
  background-color: var(--bg-dark);
  color: var(--text-dark);
  box-shadow: 0 2px 4px rgba(255, 255, 255, 0.05);
}

.ios-upload-button:hover {
  background-color: var(--table-row-hover-light);
  box-shadow: 0 3px 6px rgba(0, 0, 0, 0.08);
}

body.dark .ios-upload-button:hover {
  background-color: var(--table-row-hover-dark);
  box-shadow: 0 3px 6px rgba(255, 255, 255, 0.08);
}

.ios-upload-button:active {
  background-color: var(--table-row-bg-light);
  transform: scale(0.98);
}

body.dark .ios-upload-button:active {
  background-color: var(--table-row-bg-dark);
}

/* Icon inside button */
.ios-upload-button .icon {
  width: 1.25rem;
  height: 1.25rem;
  stroke: var(--text-light);
  transition: stroke 0.5s ease;
}

body.dark .ios-upload-button .icon {
  stroke: var(--text-dark);
}

/* Buttons */
button {
  padding: 0.7rem 1.5rem;
  border: none;
  font-family: 'Montserrat', sans-serif;
  font-size: 16px;
  background-color: var(--btn-bg-light);
  border-radius: 100px;
  font-weight: 800;
  color: #fff;
  cursor: pointer;
  min-width: 140px;
  transition: background-color 0.3s ease, color 0.5s ease;
  display: inline-flex;
  justify-content: center;
  align-items: center;
  gap: 8px;
  user-select: none;
  white-space: nowrap;
}

body.dark button {
  background-color: var(--btn-bg-dark);
  color: #000;
}

button:hover:not(:disabled) {
  background-color: var(--btn-hover-light);
}

body.dark button:hover:not(:disabled) {
  background-color: var(--btn-hover-dark);
  color: #fff;
}

button:active:not(:disabled) {
  transform: scale(0.96);
}

button:disabled {
  cursor: not-allowed;
  opacity: 0.7;
}

/* Button container */
.btn-container {
  display: flex;
  justify-content: center;
  gap: 1rem;
  flex-wrap: wrap;
  margin-top: 1rem;
margin-bottom: 10px;
}

/* Spinner */
.spinner {
  display: inline-block;
  width: 16px;
  height: 16px;
  border: 3px solid #ccc;
  border-top: 3px solid #555;
  border-radius: 50%;
  animation: spin 0.8s linear infinite;
  vertical-align: middle;
  margin-right: 8px;
}

@keyframes spin {
  to { transform: rotate(360deg); }
}


/* Notifications */
#notification-container {
  position: fixed;
  bottom: 1.5rem;
  right: 1.5rem;
  z-index: 9999;
  display: flex;
  flex-direction: column;
  gap: 0.8rem;
  max-width: 320px;
  pointer-events: none;
}

.notification {
  pointer-events: auto;
  padding: 1rem 1.5rem;
  border-radius: 12px;
  color: #fff;
  font-weight: 700;
  box-shadow: 0 4px 15px rgba(0,0,0,0.2);
  opacity: 0;
  transform: scale(0.8);
  animation-fill-mode: forwards;
  font-family: 'Montserrat', sans-serif;
  display: flex;
  justify-content: space-between;
  align-items: center;
  gap: 12px;
  cursor: default;
  position: fixed;
  top: 50%;
  left: 50%;
  transform-origin: center center;
  transform: translate(-50%, -50%) scale(0.8);
  z-index: 9999;
}

.notification.show {
  animation: fadeScaleIn 0.4s forwards;
}

.notification.hide {
  animation: fadeScaleOut 0.4s forwards;
}

@keyframes fadeScaleIn {
  to {
    opacity: 1;
    transform: translate(-50%, -50%) scale(1);
  }
}

@keyframes fadeScaleOut {
  to {
    opacity: 0;
    transform: translate(-50%, -50%) scale(0.8);
  }
}

.notification.success {
  background-color: var(--success-bg-light);
  border: 1px solid var(--success-border-light);
}

body.dark .notification.success {
  background-color: var(--success-bg-dark);
  border: 1px solid var(--success-border-dark);
}

.notification.error {
  background-color: var(--error-bg-light);
  border: 1px solid var(--error-border-light);
}

body.dark .notification.error {
  background-color: var(--error-bg-dark);
  border: 1px solid var(--error-border-dark);
}

.notification .close-btn {
  background: transparent;
  border: none;
  color: #fff;
  font-size: 1.2rem;
  cursor: pointer;
  font-weight: 700;
  padding: 0;
}

/* Table */
.iso-table {
  width: 100%;
  border-collapse: collapse;
  font-family: 'Montserrat', sans-serif;
  font-size: 15px;
  color: var(--text-light);
  background: transparent;
  table-layout: fixed;
  word-wrap: break-word;
  transition: color 0.5s ease;
  margin-top :18px;
}

body.dark .iso-table {
  color: var(--text-dark);
}

.iso-table th {
  text-align: center;
  font-weight: 700;
  padding: 10px 7px;
  color: white;
  background-color: #000;
  white-space: nowrap;
  overflow: hidden;
  text-overflow: ellipsis;
  transition: background-color 0.5s ease, color 0.5s ease, border-color 0.5s ease;
}

body.dark .iso-table th {
  color: black;
  background-color: #fff;
}

.iso-table th:first-child {
  border-top-left-radius: 15px;
}

.iso-table th:last-child {
  border-top-right-radius: 15px;
}

.iso-table tbody tr {
  background: var(--table-row-bg-light);
  box-shadow: 0 1px 3px rgb(60 60 67 / 0.3);
  transition: background-color 0.3s ease;
  cursor: default;
}

body.dark .iso-table tbody tr {
  background: var(--table-row-bg-dark);
  box-shadow: 0 1px 3px rgb(255 255 255 / 0.1);
}

.iso-table tbody tr:hover {
  background: var(--table-row-hover-light);
}

body.dark .iso-table tbody tr:hover {
  background: var(--table-row-hover-dark);
}

.iso-table td {
  padding: 12px 8px;
  border: 1px solid var(--table-border-light);
  font-weight: 400;
  font-size: 14px;
  text-align: center;
  white-space: nowrap;
  overflow: hidden;
  text-overflow: ellipsis;
  transition: border-color 0.5s ease;
}

body.dark .iso-table td {
  border: 1px solid var(--table-border-dark);
}

/* Responsive */
@media (max-width: 480px) {
  .form-group {
    flex: 1 1 100%;
  }

  #waktu {
    font-size: 2.2rem;
  }
}
/* From Uiverse.io by chicogale */ 
.cyber-toggle-wrapper {
  display: inline-flex;
  flex-direction: row; /* supaya label sejajar kanan kiri */
  justify-content: center; /* tengah secara horizontal */
  align-items: center;
  position: fixed;
  bottom: 10px; /* jarak dari bawah layar */
  left: 50%;
  transform: translateX(-50%);
  padding: 0;
  gap: 12px; /* jarak horizontal antara toggle dan tulisan */
  background: transparent;
  z-index: 1000;
}
.cyber-toggle-checkbox {
  position: absolute;
  opacity: 0;
  width: 0;
  height: 0;
}

.cyber-toggle {
  position: relative;
  display: inline-block;
  width: 40px;  /* dari 64px ke 40px */
  height: 20px; /* dari 32px ke 20px */
  cursor: pointer;
}

.cyber-toggle-track {
  position: absolute;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  background: #111;
  border-radius: 16px;
  overflow: hidden;
  box-shadow:
    0 4px 8px rgba(0, 0, 0, 0.5),
    inset 0 0 4px rgba(0, 0, 0, 0.8);
  transition: all 0.4s cubic-bezier(0.3, 1.5, 0.7, 1);
}

.cyber-toggle-track::before {
  content: "";
  position: absolute;
  inset: 2px;
  border-radius: 14px;
  background: #222;
  box-shadow: inset 0 0 5px rgba(0, 0, 0, 0.5);
  z-index: 0;
  transition: all 0.4s ease;
}

.cyber-toggle-track-glow {
  position: absolute;
  top: 0;
  left: 0;
  right: 0;
  bottom: 0;
  background: linear-gradient(90deg, #ff0000, #ffa500);
  opacity: 0;
  border-radius: 16px;
  z-index: 1;
  transition: all 0.4s ease;
}

.cyber-toggle-thumb {
  position: absolute;
  width: 14px;  /* dari 24px ke 14px */
  height: 14px; /* dari 24px ke 14px */
  top: 3px;     /* sesuaikan posisi vertikal */
  left: 3px;    /* posisi awal thumb */
  background: #151515;
  border-radius: 50%;
  z-index: 2;
  transition: all 0.4s cubic-bezier(0.3, 1.5, 0.7, 1);
  box-shadow: 0 2px 5px rgba(0, 0, 0, 0.4);
}

.cyber-toggle-thumb-shadow {
  position: absolute;
  inset: 0;
  border-radius: 50%;
  background: radial-gradient(
    circle at 30% 30%,
    rgba(255, 255, 255, 0.1),
    transparent 70%
  );
  z-index: 1;
}

.cyber-toggle-thumb-highlight {
  position: absolute;
  inset: 0;
  border-radius: 50%;
  background: radial-gradient(
    circle at 70% 70%,
    rgba(0, 0, 0, 0.2),
    transparent 70%
  );
  z-index: 1;
}

.cyber-toggle-thumb-icon {
  position: absolute;
  inset: 0;
  display: flex;
  justify-content: center;
  align-items: center;
  z-index: 2;
  opacity: 0.7;
  transition:
    opacity 0.4s ease,
    transform 0.4s ease;
}

.cyber-toggle-thumb-icon svg {
  width: 14px;
  height: 14px;
  fill: #555;
  transition:
    fill 0.4s ease,
    transform 0.4s ease;
}

.cyber-toggle-track-dots {
  position: absolute;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  display: flex;
  justify-content: flex-end;
  align-items: center;
  padding-right: 10px;
  z-index: 1;
}

.cyber-toggle-track-dot {
  width: 3px;
  height: 3px;
  border-radius: 50%;
  background: #444;
  margin-left: 3px;
  opacity: 0.5;
  transition: all 0.4s ease;
}

.cyber-toggle-particles {
  position: absolute;
  inset: 0;
  z-index: 0;
  overflow: hidden;
  pointer-events: none;
}

.cyber-toggle-particle {
  position: absolute;
  width: 3px;
  height: 3px;
  background: #ffa500; /* ganti dari biru ke orange */
  border-radius: 50%;
  opacity: 0;
  filter: blur(1px);
  transition: all 0.3s ease;
  box-shadow: 0 0 4px rgba(255, 165, 0, 0.8); /* orange shadow */
}

.cyber-toggle-particle:nth-child(1) {
  top: 15%;
  right: 20%;
}

.cyber-toggle-particle:nth-child(2) {
  top: 45%;
  right: 30%;
}

.cyber-toggle-particle:nth-child(3) {
  top: 25%;
  right: 40%;
}

.cyber-toggle-particle:nth-child(4) {
  top: 60%;
  right: 15%;
}

.cyber-toggle-labels {
  display: flex;
  flex-direction: row; /* horizontal */
  gap: 10px; /* jarak spasi antar label */
  width: auto;
  margin-top: 0;
  font-size: 12px;
  font-weight: 600;
  text-transform: uppercase;
  letter-spacing: 1px;
  font-family: "Segoe UI", Tahoma, Geneva, Verdana, sans-serif;
}

.cyber-toggle-label-off {
  color: #555;
  transition: all 0.4s ease;
}

.cyber-toggle-label-on {
  color: #555;
  transition: all 0.4s ease;
}

/* Stati attivi */
.cyber-toggle-checkbox:checked + .cyber-toggle .cyber-toggle-track-glow {
  opacity: 0.5;
}

.cyber-toggle-checkbox:checked + .cyber-toggle .cyber-toggle-thumb {
  left: calc(100% - 17px); /* sesuaikan dengan ukuran kecil */
  background: #222;
}

.cyber-toggle-checkbox:checked + .cyber-toggle .cyber-toggle-thumb-icon {
  transform: rotate(360deg);
}

.cyber-toggle-checkbox:checked + .cyber-toggle .cyber-toggle-thumb-icon svg {
  fill: #ffa500;
}

.cyber-toggle-checkbox:checked + .cyber-toggle .cyber-toggle-track-dot {
  background: #ffa500; /* ganti dari biru ke orange */
  box-shadow: 0 0 4px #ffa500; /* ganti dari biru ke orange */
  opacity: 1;
}

.cyber-toggle-checkbox:checked ~ .cyber-toggle-labels .cyber-toggle-label-on {
color: #ffa500; /* ganti dari biru ke orange */
  text-shadow: 0 0 5px rgba(255, 165, 0, 0.5); /* ganti dari biru ke orange */
}

.cyber-toggle-checkbox:not(:checked)
  ~ .cyber-toggle-labels
  .cyber-toggle-label-off {
  color: #aaa;
}

/* Animazione particelle quando attivo */
.cyber-toggle-checkbox:checked + .cyber-toggle .cyber-toggle-particle {
  opacity: 1;
  animation: cyber-toggle-float 3s infinite alternate;
}

.cyber-toggle-checkbox:checked
  + .cyber-toggle
  .cyber-toggle-particle:nth-child(1) {
  animation-delay: 0s;
}

.cyber-toggle-checkbox:checked
  + .cyber-toggle
  .cyber-toggle-particle:nth-child(2) {
  animation-delay: 0.5s;
}

.cyber-toggle-checkbox:checked
  + .cyber-toggle
  .cyber-toggle-particle:nth-child(3) {
  animation-delay: 1s;
}

.cyber-toggle-checkbox:checked
  + .cyber-toggle
  .cyber-toggle-particle:nth-child(4) {
  animation-delay: 1.5s;
}

/* Effetto hover */
.cyber-toggle:hover .cyber-toggle-track::before {
  background: #272727;
}

.cyber-toggle:hover .cyber-toggle-thumb {
  box-shadow: 0 2px 8px rgba(0, 0, 0, 0.6);
}

.cyber-toggle-checkbox:checked + .cyber-toggle:hover .cyber-toggle-track-glow {
  opacity: 0.7;
}

/* Effetto focus per accessibilitÃ  */
.cyber-toggle-checkbox:focus + .cyber-toggle {
  outline: none;
}

.cyber-toggle-checkbox:focus + .cyber-toggle::after {
  content: "";
  position: absolute;
  inset: -4px;
  border-radius: 20px;
  border: 2px solid rgba(255, 165, 0, 0.5);
  opacity: 0.5;
}

/* === OFF STATE (putih dengan border hitam) === */
.cyber-toggle-checkbox:not(:checked) + .cyber-toggle .cyber-toggle-track {
  background: white;
  border: 2px solid black;
  box-shadow: none;
}

.cyber-toggle-checkbox:not(:checked) + .cyber-toggle .cyber-toggle-track::before {
  background: white;
  box-shadow: none;
}

.cyber-toggle-checkbox:not(:checked) + .cyber-toggle .cyber-toggle-thumb {
  background: white;
  border: 2px solid black;
  box-shadow: none;
}

.cyber-toggle-checkbox:not(:checked) + .cyber-toggle .cyber-toggle-thumb-icon svg {
  fill: #000; /* Ikon hitam */
}

.cyber-toggle-checkbox:not(:checked) + .cyber-toggle .cyber-toggle-track-dot {
  background: #000; /* Titik hitam */
  box-shadow: none;
}

@keyframes cyber-toggle-float {
  0% {
    transform: translateY(0);
  }
  50% {
    transform: translateY(-4px);
  }
  100% {
    transform: translateY(0);
  }
}
.header-img {
  display: block;
  margin: 0 auto 1rem;
  width: 450px;
  max-width: 100%;
  transition: filter 0.5s ease;
  user-select: none;
}
body.dark .header img:hover {
  filter: drop-shadow(0 0 10px #ffa500);
  cursor: pointer; /* opsional, biar mouse berubah jadi pointer */
}
</style>
</head>
<body>
  <div class="container">
   <img id="header-img" class="header-img" src="https://i.imgur.com/aQK5ZiT.png" alt="Header" draggable="false" />
    <p class="subtitle" id="subtitle">Selamat Datang, silahkan absen dulu ya.</p>
    <form id="absenForm" autocomplete="off" novalidate>
      <div class="form-group">
        <label for="nama"></label>
        <input type="text" id="nama" name="nama" placeholder="Masukkan nama lengkap" readonly required />
      </div>

      <div class="form-group">
        <label for="tanggal"></label>
        <input type="date" id="tanggal" name="tanggal" readonly required />
      </div>

      <div class="form-group full">
        <div id="waktu">--:--:--</div>
      </div>

      <label for="foto" class="ios-upload-button" role="button" tabindex="0">
        <svg xmlns="http://www.w3.org/2000/svg" class="icon" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" focusable="false">
          <path stroke-linecap="round" stroke-linejoin="round" d="M3 7.5a1.5 1.5 0 011.5-1.5h2.086a1.5 1.5 0 001.06-.44l.914-.914A1.5 1.5 0 019.621 4.5h4.758a1.5 1.5 0 011.06.44l.914.914a1.5 1.5 0 001.06.44H19.5A1.5 1.5 0 0121 7.5v9a1.5 1.5 0 01-1.5 1.5h-15A1.5 1.5 0 013 16.5v-9z" />
          <path stroke-linecap="round" stroke-linejoin="round" d="M12 15.75a3.75 3.75 0 100-7.5 3.75 3.75 0 000 7.5z" />
        </svg>
        Take a picture
      </label>
      <input type="file" id="foto" name="foto" accept="image/*" capture="environment" required hidden />
      <div class="form-group full">
        <img id="preview" alt="Preview Foto" style="max-width: 100%; display: none;" />
      </div>

<div class="btn-container">
  <button type="button" id="btnCekInOut">Cek In</button>
  <button type="button" id="btnMenuUtama">Menu</button>
  <button type="button" id="btnLogout">Logout</button>
</div>
    </form>

    <!-- Tabel style ISO -->
<table id="tabelAbsen" class="iso-table" style="display: none;">
  <thead>
    <tr>
      <th>Nama</th>
      <th>Tanggal</th>
      <th>Waktu</th>
      <th>Status</th>
    </tr>
  </thead>
  <tbody id="dataAbsen"></tbody>
</table>

    <div id="notification-container" aria-live="polite" aria-atomic="true"></div>
<div class="cyber-toggle-wrapper">
  <input class="cyber-toggle-checkbox" id="mode-toggle" type="checkbox" />
  <label class="cyber-toggle" for="mode-toggle">
    <div class="cyber-toggle-track">
      <div class="cyber-toggle-track-glow"></div>
      <div class="cyber-toggle-track-dots">
        <span class="cyber-toggle-track-dot"></span>
        <span class="cyber-toggle-track-dot"></span>
        <span class="cyber-toggle-track-dot"></span>
      </div>
    </div>
    <div class="cyber-toggle-thumb">
      <div class="cyber-toggle-thumb-shadow"></div>
      <div class="cyber-toggle-thumb-highlight"></div>
      <div class="cyber-toggle-thumb-icon">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
          <path
            d="M16.5 12c0-2.48-2.02-4.5-4.5-4.5s-4.5 2.02-4.5 4.5 2.02 4.5 4.5 4.5 4.5-2.02 4.5-4.5zm-4.5 7.5c-4.14 0-7.5-3.36-7.5-7.5s3.36-7.5 7.5-7.5 7.5 3.36 7.5 7.5-3.36 7.5-7.5 7.5zm0-16.5c-4.97 0-9 4.03-9 9h-3l3.89 3.89.07.14 4.04-4.03h-3c0-3.87 3.13-7 7-7s7 3.13 7 7-3.13 7-7 7c-1.93 0-3.68-.79-4.94-2.06l-1.42 1.42c1.63 1.63 3.87 2.64 6.36 2.64 4.97 0 9-4.03 9-9s-4.03-9-9-9z"
          ></path>
        </svg>
      </div>
    </div>
    <div class="cyber-toggle-particles">
      <span class="cyber-toggle-particle"></span>
      <span class="cyber-toggle-particle"></span>
      <span class="cyber-toggle-particle"></span>
      <span class="cyber-toggle-particle"></span>
    </div>
  </label>
  <div class="cyber-toggle-labels">
    <span class="cyber-toggle-label-off">LIGHT </span>
    <span class="cyber-toggle-label-on">  DARK</span>  
</div>
  
<script>
/* === Variabel Global === */
  const allowedLocations = [
  { name: "MC UIN", latitude: -7.949995103393123, longitude: 112.60891325507173, radius: 250 },
  { name: "MC UMM", latitude: -7.919636762010002, longitude: 112.59764209554523, radius: 250 }
];
  
  let currentStatusAbsensi = 'none'; // global
  
/* === Fungsi di scope global agar bisa dipakai di mana saja === */
function formatTanggal(dateInput) {
  const date = new Date(dateInput);
  const dd = String(date.getDate()).padStart(2, '0');
  const mm = String(date.getMonth() + 1).padStart(2, '0');
  const yyyy = date.getFullYear();
  return `${dd}/${mm}/${yyyy}`;
}

// Contoh penggunaan:
const tanggalAsli = document.querySelector("#tanggal").value; // ISO string seperti "2025-06-04"
const tanggalFormatted = formatTanggal(tanggalAsli);

// Kirim tanggalFormatted ke server, bukan tanggalAsli


function excelTimeToTime(excelTime) {
  if (typeof excelTime !== 'number' || isNaN(excelTime)) return null;
  const totalSeconds = Math.round(excelTime * 24 * 60 * 60);
  const hours = Math.floor(totalSeconds / 3600);
  const minutes = Math.floor((totalSeconds % 3600) / 60);
  const seconds = totalSeconds % 60;
  return `${String(hours).padStart(2,'0')}:${String(minutes).padStart(2,'0')}:${String(seconds).padStart(2,'0')}`;
}

function formatWaktu(waktu) {
  if (!waktu) return '-';

  // Jika angka (mungkin waktu Excel seperti 0.5 = 12:00)
  const num = parseFloat(waktu);
  if (!isNaN(num) && num > 0 && num < 1.5) { // asumsi nilai masuk akal
    const hasil = excelTimeToTime(num);
    if (hasil) return hasil;
  }

  // Jika string ISO atau waktu normal
  const d = new Date(waktu);
  if (!isNaN(d.getTime())) {
    return d.toTimeString().split(' ')[0]; // ambil HH:MM:SS
  }

  // Jika sudah string waktu valid
  if (/^\d{2}:\d{2}(:\d{2})?$/.test(waktu)) {
    return waktu.length === 5 ? waktu + ':00' : waktu;
  }

  return '-'; // fallback
}

  function normalizeDate(dateStr) {
  // contoh jika tanggal server formatnya "dd-mm-yyyy"
  const parts = dateStr.split('-');
  if(parts.length === 3) {
    return `${parts[2]}-${parts[1].padStart(2,'0')}-${parts[0].padStart(2,'0')}`; // jadi yyyy-mm-dd
  }
  return dateStr; // fallback
}
  
/* === Variabel Global === */
let sudahCekIn = false;
let btnCekInOut;

/* === Saat DOM Selesai Dimuat === */
window.addEventListener('DOMContentLoaded', () => {
  // Set tanggal hari ini
  const now = new Date();
  const todayFormatted = `${now.getFullYear()}-${String(now.getMonth() + 1).padStart(2, '0')}-${String(now.getDate()).padStart(2, '0')}`;
  document.getElementById('tanggal').value = todayFormatted;

  // Isi nama dari localStorage
  const nama = localStorage.getItem('nama') || '';
  document.getElementById('nama').value = nama;

  // Cek login, redirect jika belum login
  if (!localStorage.getItem("username") || !localStorage.getItem("nama")) {
    alert("Anda belum login.");
    window.location.href = "/index.html";
    return; // supaya tidak lanjut
  }

  // Inisialisasi btnCekInOut global
  btnCekInOut = document.getElementById('btnCekInOut');
  if (btnCekInOut) {
    btnCekInOut.addEventListener('click', withSpinner(btnCekInOut, handleCekInOut));
  }

  // Load data absensi pertama kali dan set interval refresh tiap 10 detik
  loadDataDariSheet();
  setInterval(loadDataDariSheet, 10000);

  // Pasang event listener tombol menu dan logout (jika ada)
  pasangEventMenuLogout();
});

/* === Fungsi untuk update tombol berdasarkan status absensi === */
function updateTombol(statusAbsensi) {
  const btn = document.getElementById('btnCekInOut');
  if (!btn) return;

  if (statusAbsensi === 'none') {
    btn.textContent = 'Cek In';
    btn.disabled = false;
  } else if (statusAbsensi === 'in') {
    btn.textContent = 'Cek Out';
    btn.disabled = false;
  } else if (statusAbsensi === 'out') {
    btn.textContent = 'Sudah Absen';
    btn.disabled = true;
  } else {
    btn.textContent = 'Cek In';
    btn.disabled = false;
  }
}

/* === Fungsi Load Data dari Sheet === */
async function loadDataDariSheet() {
  try {
    const response = await fetch('https://distinct-flint-fig.glitch.me/api/absensi?action=getAbsensi');
    if (!response.ok) throw new Error('Server merespon dengan status ' + response.status);

    const json = await response.json();
    const data = json.data;
    if (!Array.isArray(data)) throw new Error('Data absensi bukan array');

    const nama = localStorage.getItem('nama');
    const username = localStorage.getItem('username');
    if (!nama || !username) throw new Error("Nama atau username tidak ditemukan di localStorage");

    const today = new Date().toLocaleDateString('sv-SE'); // YYYY-MM-DD

    // Filter data absensi user hari ini
    const filteredToday = data.filter(row =>
      row.nama?.toLowerCase() === nama.toLowerCase() &&
      row.tanggal === today
    );

    console.log('Absensi hari ini:', filteredToday.map(r => r.status));

    // Jika tidak ada data absensi hari ini
    if (!filteredToday || filteredToday.length === 0) {

      updateStatusSudahAbsen('none');
      const tbody = document.getElementById('dataAbsen');
      if (tbody) tbody.innerHTML = '';
      document.getElementById('tabelAbsen').style.display = 'none';
      updateTombol('none');
      return;
    }

    // Tampilkan data absensi hari ini di tabel
    const tbody = document.getElementById('dataAbsen');
    tbody.innerHTML = '';

    filteredToday.forEach(row => {
      const tr = document.createElement('tr');
      tr.innerHTML = `
        <td>${row.nama}</td>
        <td>${formatTanggal(row.tanggal)}</td>
        <td>${formatWaktu(row.waktu || '')}</td>
        <td>${row.status}</td>
      `;
      tbody.appendChild(tr);
    });

    document.getElementById('tabelAbsen').style.display = 'table';

    // Cek status absensi hari ini
    const sudahCekIn = filteredToday.some(row => row.status?.toLowerCase() === 'cek in');
    const sudahCekOut = filteredToday.some(row => row.status?.toLowerCase() === 'cek out');

    let statusAbsensi = 'none';
    if (sudahCekOut) statusAbsensi = 'out';
    else if (sudahCekIn) statusAbsensi = 'in';

    currentStatusAbsensi = statusAbsensi;
    updateStatusSudahAbsen(statusAbsensi);
    updateTombol(statusAbsensi);

  } catch (error) {
    console.error('Error loadDataDariSheet:', error);
    showNotification('Gagal ambil data absensi', 'error');
  }
}
// Contoh: update tampilan status
function updateStatusSudahAbsen(status) {
  const el = document.getElementById('statusAbsenHariIni');
  const tombol = document.getElementById('tombolAbsen');

  if (el) {
    switch (status) {
      case 'none':
        el.textContent = 'âŒ Belum Absen Hari Ini';
        el.style.color = 'red';
        if (tombol) {
          tombol.textContent = 'Cek In';
          tombol.disabled = false;
        }
        break;
      case 'in':
        el.textContent = 'ðŸ•’ Sudah Cek In, Belum Cek Out';
        el.style.color = 'orange';
        if (tombol) {
          tombol.textContent = 'Cek Out';
          tombol.disabled = false;
        }
        break;
      case 'out':
        el.textContent = 'âœ… Sudah Cek Out, Absensi Selesai';
        el.style.color = 'green';
        if (tombol) {
          tombol.textContent = 'Sudah Cek Out';
          tombol.disabled = true;  // tombol nonaktifkan karena sudah selesai
        }
        break;
      default:
        el.textContent = '';
        if (tombol) {
          tombol.textContent = 'Cek In';
          tombol.disabled = false;
        }
    }
  }
}

function getShiftStatus(nama) {
  if (nama === 'Ananda Arif Putra') {
    // Bypass cek waktu absen, dianggap selalu tepat waktu dan shift 2
    return { shift: 2, status: 'Tepat Waktu' };
  }

  const now = new Date();
  const timeToday = (h, m) => {
    const d = new Date(now);
    d.setHours(h, m, 0, 0);
    return d;
  };

  // SHIFT 1
  const shift1Start = timeToday(00,01);
  const shift1End = timeToday(23, 59);      // Check-in terakhir untuk dianggap shift 1
  const shift1Late = timeToday(8, 10);    // Terlambat jika lewat jam 08:10

  // SHIFT 2
  const shift2Start = timeToday(10, 0);
  const shift2End = timeToday(23, 59);     // Check-in terakhir untuk dianggap shift 2
  const shift2Late = timeToday(13, 10);   // Terlambat jika lewat jam 13:10

  if (now >= shift1Start && now <= shift1End) {
    return {
      shift: 1,
      status: now > shift1Late ? 'Terlambat' : 'Tepat Waktu'
    };
  } else if (now >= shift2Start && now <= shift2End) {
    return {
      shift: 2,
      status: now > shift2Late ? 'Terlambat' : 'Tepat Waktu'
    };
  } else {
    // Di luar jam absensi
    return {
      shift: null,
      status: null
    };
  }
}
// === Fungsi Hitung Jarak (Haversine) ===
function getDistance(lat1, lon1, lat2, lon2) {
  const R = 6371e3;
  const Ï†1 = lat1 * Math.PI / 180;
  const Ï†2 = lat2 * Math.PI / 180;
  const Î”Ï† = (lat2 - lat1) * Math.PI / 180;
  const Î”Î» = (lon2 - lon1) * Math.PI / 180;
  const a = Math.sin(Î”Ï† / 2) ** 2 +
            Math.cos(Ï†1) * Math.cos(Ï†2) *
            Math.sin(Î”Î» / 2) ** 2;
  return R * (2 * Math.atan2(Math.sqrt(a), Math.sqrt(1 - a)));
}

// === Cari Lokasi Terdekat yang Valid ===
function getAllowedLocationName(currentLat, currentLon) {
  for (let loc of allowedLocations) {
    if (
      typeof loc.latitude !== 'number' ||
      typeof loc.longitude !== 'number' ||
      typeof loc.radius !== 'number'
    ) continue;

    const distance = getDistance(currentLat, currentLon, loc.latitude, loc.longitude);
    if (distance <= loc.radius) {
      return loc.name;
    }
  }
  return null;
}

// === Cek Lokasi Sebelum Absensi ===
async function checkLocationBeforeAbsen() {
  return new Promise((resolve) => {
    if (!navigator.geolocation) {
      console.warn("Geolocation tidak didukung.");
      return resolve({ name: "Lokasi Tidak Dapat Diperoleh", latitude: null, longitude: null });
    }

    navigator.geolocation.getCurrentPosition(
      pos => {
        const { latitude, longitude } = pos.coords;
        const locationName = getAllowedLocationName(latitude, longitude);
        resolve({
          name: locationName || "Di Luar Lokasi",
          latitude,
          longitude
        });
      },
      err => {
        console.warn("Gagal mendapatkan lokasi:", err.message);
        resolve({ name: "Lokasi Tidak Dapat Diperoleh", latitude: null, longitude: null });
      },
      { enableHighAccuracy: true, timeout: 10000, maximumAge: 0 }
    );
  });
}
/* === Logika Cek In / Cek Out === */
async function handleCekInOut() {
  try {
    const nama = absenForm.nama.value.trim();
    if (!nama) return showNotification('Nama wajib diisi!', 'error');

    const tanggal = absenForm.tanggal.value;
    const waktu = document.getElementById('waktu').textContent;

    if (!absenForm.foto.files.length) {
      return showNotification('Foto wajib diupload!', 'error');
    }

    // Ambil status tombol sekarang (yang sudah diupdate oleh loadDataDariSheet)
    const btn = document.getElementById('btnCekInOut');
    if (!btn) return showNotification('Tombol absensi tidak ditemukan', 'error');

    // Tentukan status dari teks tombol
    let status = '';
    // Gunakan statusAbsensi global, bukan textContent tombol
    if (currentStatusAbsensi === 'none') {
      status = 'Cek In';
    } else if (currentStatusAbsensi === 'in') {
      status = 'Cek Out';
    } else {
      return showNotification('Anda sudah Cek In & Out hari ini!', 'error');
    }

    // Admin bypass lokasi
    let lokasi;
    if (nama.toLowerCase() === 'admin') {
      lokasi = { name: "Admin Override", latitude: null, longitude: null };
    } else {
      lokasi = await checkLocationBeforeAbsen();

      if (!lokasi.name || lokasi.name.toLowerCase().includes("tidak") || lokasi.name === "Di Luar Lokasi") {
        return showNotification("Absensi hanya dari lokasi yang diizinkan!", "error");
      }
    }

    // Cek shift
    const shiftInfo = getShiftStatus(nama);
    if (!shiftInfo.shift) {
      return showNotification("Absensi hanya bisa pada Shift 1 (04:00-09:00) atau Shift 2 (11:00-14:00).", "error");
    }
    showNotification(`Shift ${shiftInfo.shift}: ${shiftInfo.status}`, "info");

    // Kirim data absensi ke server
    await kirimAbsensiKeGAS({
      nama,
      tanggal,
      waktu,
      status,
      lokasiNama: lokasi.name,
      lokasiKoordinat: (lokasi.latitude != null && lokasi.longitude != null) ? `${lokasi.latitude},${lokasi.longitude}` : "0,0"
    }, absenForm.foto.files[0]);

    // Reset form foto & preview
    absenForm.foto.value = '';
    document.getElementById('preview').style.display = 'none';

    // Reload data absensi dari server, yang juga update tombol dan localStorage
    await loadDataDariSheet();

    showNotification('Absensi berhasil!', 'success');

  } catch (error) {
    console.error("Error handleCekInOut:", error);
    showNotification(error.message || 'Gagal absensi', 'error');
  }
}

/* === Kirim Data Absensi ke Endpoint GAS/Glitch === */
async function kirimAbsensiKeGAS(data, file) {
  if (!file || !file.type.startsWith('image/')) {
    throw new Error("File foto kosong atau bukan gambar!");
  }

  const base64Foto = await new Promise((resolve, reject) => {
    new Compressor(file, {
      quality: 0.4,
      maxWidth: 600,
      maxHeight: 600,
      convertSize: 1_000_000,
      success(result) {
        const reader = new FileReader();
        reader.onload = () => resolve(reader.result);
        reader.onerror = reject;
        reader.readAsDataURL(result);
      },
      error(err) {
        reject(err);
      }
    });
  });

  const payload = {
    action: "submitAbsensi",
    ...data,
    fotoBase64: base64Foto
  };

  const res = await fetch("https://distinct-flint-fig.glitch.me/api/absensi", {
    method: "POST",
    headers: { "Content-Type": "application/json" },
    body: JSON.stringify(payload)
  });

  const text = await res.text();
  let result;
  try {
    result = JSON.parse(text);
  } catch {
    throw new Error("Respon server bukan JSON: " + text);
  }

  if (!result.success) {
    throw new Error(result.message || "Gagal kirim data absensi");
  }
}
  
  /* === Jam Real-Time === */
function updateWaktu() {
  const now = new Date();
  const jam = now.toTimeString().split(' ')[0];
  document.getElementById('waktu').textContent = jam;
}
setInterval(updateWaktu, 1000);
updateWaktu();

/* === Auto Logout Saat Tidak Aktif === */
const IDLE_TIMEOUT = 15 * 60 * 1000; // 15 menit
let idleTimer;
function resetIdleTimer() {
  clearTimeout(idleTimer);
  idleTimer = setTimeout(() => {
    alert("Anda logout karena tidak aktif.");
    localStorage.clear();
    window.location.href = "/index.html";
  }, IDLE_TIMEOUT);
}
['mousemove', 'keydown', 'scroll', 'touchstart'].forEach(evt =>
  document.addEventListener(evt, resetIdleTimer)
);
resetIdleTimer();

/* === Notifikasi Dinamis === */
function showNotification(message, type = 'success', duration = 3000) {
  const notif = document.createElement('div');
  notif.className = `notification ${type}`;
  notif.textContent = message;
  document.getElementById('notification-container').appendChild(notif);
  setTimeout(() => notif.classList.add('show'), 10);
  setTimeout(() => {
    notif.classList.remove('show');
    notif.classList.add('hide');
  }, duration);
  notif.addEventListener('animationend', () => {
    if (notif.classList.contains('hide')) notif.remove();
  });
}

  /* === Dark Mode === */
const toggle = document.getElementById('mode-toggle');
const body = document.body;
const headerImg = document.getElementById('header-img');
const subtitle = document.getElementById('subtitle');

function initMode() {
  const prefersDark = window.matchMedia('(prefers-color-scheme: dark)').matches;
  body.classList.toggle('dark', prefersDark);
  toggle.checked = prefersDark;
  headerImg.src = prefersDark ? "https://i.imgur.com/gkI2ey4.png" : "https://i.imgur.com/aQK5ZiT.png";
  subtitle.style.color = prefersDark ? "#bbb" : "#666";
}
toggle.addEventListener('change', () => {
  const isDark = toggle.checked;
  body.classList.toggle('dark', isDark);
  headerImg.src = isDark ? "https://i.imgur.com/gkI2ey4.png" : "https://i.imgur.com/aQK5ZiT.png";
  subtitle.style.color = isDark ? "#bbb" : "#666";
});
initMode();

/* === Spinner Wrapper untuk Tombol Async === */
function withSpinner(button, asyncFn) {
  return async function () {
    if (button.disabled) return;
    const originalHTML = button.innerHTML;
    button.disabled = true;
    button.innerHTML = `<span class="spinner"></span>`;
    try {
      await asyncFn();
    } catch (err) {
      showNotification('Terjadi kesalahan!', 'error');
      console.error(err);
    } finally {
      button.disabled = false;
      button.innerHTML = originalHTML;
    }
  };
}
  /* === Preview Foto Sebelum Upload === */
document.getElementById('foto').addEventListener('change', function () {
  const file = this.files[0];
  const preview = document.getElementById('preview');

  if (!file || !file.type.startsWith('image/')) {
    preview.src = '';
    preview.style.display = 'none';
    return;
  }

  const MAX_SIZE = 2 * 1024 * 1024;
  if (file.size > MAX_SIZE) {
    alert('Ukuran foto terlalu besar! Maksimal 2MB.');
    this.value = '';
    preview.src = '';
    preview.style.display = 'none';
    return;
  }

  const reader = new FileReader();
  reader.onload = e => {
    preview.src = e.target.result;
    preview.style.display = 'block';
  };
  reader.readAsDataURL(file);
});


/* === Pasang Event Listener Menu dan Logout === */
function pasangEventMenuLogout() {
  const btnMenuUtama = document.getElementById('btnMenuUtama');
  if (btnMenuUtama) {
    btnMenuUtama.addEventListener('click', () => {
      window.location.href = "/menu.html";
    });
  }

  const btnLogout = document.getElementById('btnLogout');
  if (btnLogout) {
    btnLogout.addEventListener('click', () => {
      localStorage.removeItem('username');
      localStorage.removeItem('nama');
      // Jangan hapus status cekIn dan cekOut
      window.location.href = "/index.html";
    });
  }
}
</script>
</body>
</html>
